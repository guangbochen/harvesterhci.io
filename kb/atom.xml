<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://harvesterhci.io/kb</id>
    <title>The open source hyperconverged infrastructure (HCI) solution for a cloud native world Blog</title>
    <updated>2022-03-07T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://harvesterhci.io/kb"/>
    <subtitle>The open source hyperconverged infrastructure (HCI) solution for a cloud native world Blog</subtitle>
    <icon>https://harvesterhci.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[VM Scheduling]]></title>
        <id>vm-scheduling</id>
        <link href="https://harvesterhci.io/kb/vm-scheduling"/>
        <updated>2022-03-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[How does Harvester schedule VMs?]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_mojV" id="how-does-harvester-schedule-a-vm">How does Harvester schedule a VM?<a class="hash-link" href="#how-does-harvester-schedule-a-vm" title="Direct link to heading">​</a></h2><p>Harvester doesn't directly schedule a VM in Kubernetes, it relies on <a href="http://kubevirt.io/" target="_blank" rel="noopener noreferrer">KubeVirt</a> to create the custom resource <code>VirtualMachine</code>. When the request to create a new VM is sent, a <code>VirtualMachineInstance</code> object is created and it creates the corresponding <code>Pod</code>.</p><p>The whole VM creation processt leverages <code>kube-scheduler</code>, which allows Harvester to use <code>nodeSelector</code>, <code>affinity</code>, and resources request/limitation to influence where a VM will be deployed.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-does-kube-scheduler-decide-where-to-deploy-a-vm">How does kube-scheduler decide where to deploy a VM?<a class="hash-link" href="#how-does-kube-scheduler-decide-where-to-deploy-a-vm" title="Direct link to heading">​</a></h2><p>First, <code>kube-scheduler</code> finds Nodes available to run a pod. After that, <code>kube-scheduler</code> scores each available Node by a list of <a href="https://github.com/kubernetes/kubernetes/tree/v1.22.7/pkg/scheduler/framework/plugins" target="_blank" rel="noopener noreferrer">plugins</a> like <a href="https://github.com/kubernetes/kubernetes/blob/v1.22.7/pkg/scheduler/framework/plugins/imagelocality/image_locality.go" target="_blank" rel="noopener noreferrer">ImageLocality</a>, <a href="https://github.com/kubernetes/kubernetes/tree/v1.22.7/pkg/scheduler/framework/plugins/interpodaffinity" target="_blank" rel="noopener noreferrer">InterPodAffinity</a>, <a href="https://github.com/kubernetes/kubernetes/tree/v1.22.7/pkg/scheduler/framework/plugins/nodeaffinity" target="_blank" rel="noopener noreferrer">NodeAffinity</a>, etc. </p><p>Finally, <code>kube-scheduler</code> calculates the scores from the plugins results for each Node, and select the Node with the highest score to deploy the Pod.</p><p>For example, let's say  we have a three nodes Harvester cluster with 6 cores CPU and 16G RAM each, and we want to deploy a VM with 1 CPU and 1G RAM (without resources overcommit). </p><p><code>kube-scheduler</code> will summarize the scores, as displayed in  <em>Table 1</em> below, and will select the node with the highest score, <code>harvester-node-2</code> in this case, to deploy the VM.</p><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>kube-scheduler logs</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-0: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-1: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 45,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-2: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5350 memory:5941231616] ,score 46,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-0: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-1: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 34,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm-without-overcommit-75q9b -&gt; harvester-node-2: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5350 memory:5941231616] ,score 37,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="ImageLocality" node="harvester-node-0" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="ImageLocality" node="harvester-node-1" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="ImageLocality" node="harvester-node-2" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="InterPodAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="InterPodAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="InterPodAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesLeastAllocated" node="harvester-node-0" score=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesLeastAllocated" node="harvester-node-1" score=34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesLeastAllocated" node="harvester-node-2" score=37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodePreferAvoidPods" node="harvester-node-0" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodePreferAvoidPods" node="harvester-node-2" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodePreferAvoidPods" node="harvester-node-1" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="PodTopologySpread" node="harvester-node-0" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="PodTopologySpread" node="harvester-node-1" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="PodTopologySpread" node="harvester-node-2" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="TaintToleration" node="harvester-node-0" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="TaintToleration" node="harvester-node-1" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="TaintToleration" node="harvester-node-2" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesBalancedAllocation" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesBalancedAllocation" node="harvester-node-1" score=45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" plugin="NodeResourcesBalancedAllocation" node="harvester-node-2" score=46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" node="harvester-node-0" score=1000358</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" node="harvester-node-1" score=1000433</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm-without-overcommit-75q9b" node="harvester-node-2" score=1000437</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm-without-overcommit-75q9b", node "harvester-node-2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm-without-overcommit-75q9b", node "harvester-node-2": all PVCs bound and nothing to do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Attempting to bind pod to node" pod="default/virt-launcher-vm-without-overcommit-75q9b" node="harvester-node-2"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></details><p><strong>Table 1 - kube-scheduler scores example</strong></p><table><thead><tr><th align="center"></th><th align="center">harvester-node-0</th><th align="center">harvester-node-1</th><th align="center">harvester-node-2</th></tr></thead><tbody><tr><td align="center">ImageLocality</td><td align="center">54</td><td align="center">54</td><td align="center">54</td></tr><tr><td align="center">InterPodAffinity</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">NodeResourcesLeastAllocated</td><td align="center">4</td><td align="center">34</td><td align="center">37</td></tr><tr><td align="center">NodeAffinity</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">NodePreferAvoidPods</td><td align="center">1000000</td><td align="center">1000000</td><td align="center">1000000</td></tr><tr><td align="center">PodTopologySpread</td><td align="center">200</td><td align="center">200</td><td align="center">200</td></tr><tr><td align="center">TaintToleration</td><td align="center">100</td><td align="center">100</td><td align="center">100</td></tr><tr><td align="center">NodeResourcesBalancedAllocation</td><td align="center">0</td><td align="center">45</td><td align="center">46</td></tr><tr><td align="center">Total</td><td align="center">1000358</td><td align="center">1000433</td><td align="center">1000437</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="why-vms-are-distributed-unevenly-with-overcommit">Why VMs are distributed unevenly with overcommit?<a class="hash-link" href="#why-vms-are-distributed-unevenly-with-overcommit" title="Direct link to heading">​</a></h2><p>With resources overcommit, Harvester modifies the resources request. By default, the <code>overcommit</code> configuration is <code>{"cpu": 1600, "memory": 150, "storage":  200}</code>. This means that if we request a VM with 1 CPU and 1G RAM, its <code>resources.requests.cpu</code> will become <code>62m</code>. </p><p>!!! note
The unit suffix <code>m</code> stands for "thousandth of a core."</p><p>To explain it, let's take the case of CPU overcommit. The default value of 1 CPU is equal to 1000m CPU, and with the default overcommit configuration of <code>"cpu": 1600</code>, the CPU resource will be 16x smaller. Here is the calculation: <code>1000m * 100 / 1600 = 62m</code>.</p><p>Now, we can see how overcommitting influences <code>kube-scheduler</code> scores.</p><p>In this example, we use a three nodes Harvester cluster with 6 cores and 16G RAM each. We will deploy two VMs with 1 CPU and 1G RAM, and we will compare the scores for both cases of "with-overcommit" and "without-overcommit" resources. </p><p>The results of both tables <em>Table 2</em> and <em>Table 3</em> can be explained as follow:</p><p>In the "with-overcommit" case, both VMs are deployed on <code>harvester-node-2</code>, however in the "without-overcommit" case, the VM1 is deployed on <code>harvester-node-2</code>, and VM2 is deployed on <code>harvester-node-1</code>. </p><p>If we look at the detailed scores, we'll see a variation of <code>Total Score</code> for <code>harvester-node-2</code> from <code>1000459</code> to <code>1000461</code> in the "with-overcommit" case, and <code>1000437</code> to <code>1000382</code> in the "without-overcommit case". It's because resources overcommit influences <code>request-cpu</code> and <code>request-memory</code>. </p><p>In the "with-overcommit" case, the <code>request-cpu</code> changes from <code>4412m</code> to <code>4474m</code>. The difference between the two numbers is <code>62m</code>, which is what we calculated above. However, in the "without-overcommit" case, we send <strong>real</strong> requests to <code>kube-scheduler</code>, so the <code>request-cpu</code> changes from <code>5350m</code> to <code>6350m</code>.</p><p>Finally, since most plugins give the same scores for each node except <code>NodeResourcesBalancedAllocation</code> and <code>NodeResourcesLeastAllocated</code>, we'll see a difference of these two scores for each node.</p><p>From the results, we can see the overcommit feature influences the final score of each Node, so VMs are distributed unevenly. Although the <code>harvester-node-2</code> score for VM 2 is higher than VM 1, it's not always increasing. In <em>Table 4</em>, we keep deploying VM with 1 CPU and 1G RAM, and we can see the score of <code>harvester-node-2</code> starts decreasing from 11th VM. The behavior of <code>kube-scheduler</code> depends on your cluster resources and the workload you deployed.</p><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>kube-scheduler logs for vm1-with-overcommit</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-0: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9022 memory:14807289856] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-1: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4622 memory:5992960000] ,score 58,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-2: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4412 memory:5581918208] ,score 59,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-0: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9022 memory:14807289856] ,score 5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-1: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4622 memory:5992960000] ,score 43,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-ljlmq -&gt; harvester-node-2: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4412 memory:5581918208] ,score 46,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="InterPodAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="InterPodAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="InterPodAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-0" score=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-1" score=43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-2" score=46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodePreferAvoidPods" node="harvester-node-0" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodePreferAvoidPods" node="harvester-node-1" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodePreferAvoidPods" node="harvester-node-2" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="PodTopologySpread" node="harvester-node-0" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="PodTopologySpread" node="harvester-node-1" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="PodTopologySpread" node="harvester-node-2" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="TaintToleration" node="harvester-node-0" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="TaintToleration" node="harvester-node-1" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="TaintToleration" node="harvester-node-2" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-1" score=58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-2" score=59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="ImageLocality" node="harvester-node-0" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="ImageLocality" node="harvester-node-1" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" plugin="ImageLocality" node="harvester-node-2" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" node="harvester-node-0" score=1000359</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" node="harvester-node-1" score=1000455</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" node="harvester-node-2" score=1000459</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm1-with-overcommit-ljlmq", node "harvester-node-2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm1-with-overcommit-ljlmq", node "harvester-node-2": all PVCs bound and nothing to do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Attempting to bind pod to node" pod="default/virt-launcher-vm1-with-overcommit-ljlmq" node="harvester-node-2"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></details><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>kube-scheduler logs for vm2-with-overcommit</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-0: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9022 memory:14807289856] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-1: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4622 memory:5992960000] ,score 58,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-2: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4474 memory:6476701696] ,score 64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-0: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9022 memory:14807289856] ,score 5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-1: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4622 memory:5992960000] ,score 43,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-with-overcommit-pwrx4 -&gt; harvester-node-2: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:4474 memory:6476701696] ,score 43,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodePreferAvoidPods" node="harvester-node-0" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodePreferAvoidPods" node="harvester-node-1" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodePreferAvoidPods" node="harvester-node-2" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="PodTopologySpread" node="harvester-node-0" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="PodTopologySpread" node="harvester-node-1" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="PodTopologySpread" node="harvester-node-2" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="TaintToleration" node="harvester-node-0" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="TaintToleration" node="harvester-node-1" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="TaintToleration" node="harvester-node-2" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesBalancedAllocation" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesBalancedAllocation" node="harvester-node-1" score=58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesBalancedAllocation" node="harvester-node-2" score=64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="ImageLocality" node="harvester-node-0" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="ImageLocality" node="harvester-node-1" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="ImageLocality" node="harvester-node-2" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="InterPodAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="InterPodAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="InterPodAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesLeastAllocated" node="harvester-node-0" score=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesLeastAllocated" node="harvester-node-1" score=43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" plugin="NodeResourcesLeastAllocated" node="harvester-node-2" score=43</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" node="harvester-node-0" score=1000359</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" node="harvester-node-1" score=1000455</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" node="harvester-node-2" score=1000461</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm2-with-overcommit-pwrx4", node "harvester-node-2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm2-with-overcommit-pwrx4", node "harvester-node-2": all PVCs bound and nothing to do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Attempting to bind pod to node" pod="default/virt-launcher-vm2-with-overcommit-pwrx4" node="harvester-node-2"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></details><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>kube-scheduler logs for vm1-without-overcommit</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-0: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-1: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 45,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-2: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5350 memory:5941231616] ,score 46,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-0: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-1: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 34,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm1-with-overcommit-6xqmq -&gt; harvester-node-2: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5350 memory:5941231616] ,score 37,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="InterPodAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="InterPodAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="InterPodAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-0" score=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-1" score=34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesLeastAllocated" node="harvester-node-2" score=37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodePreferAvoidPods" node="harvester-node-0" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodePreferAvoidPods" node="harvester-node-1" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodePreferAvoidPods" node="harvester-node-2" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="PodTopologySpread" node="harvester-node-0" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="PodTopologySpread" node="harvester-node-1" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="PodTopologySpread" node="harvester-node-2" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="TaintToleration" node="harvester-node-0" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="TaintToleration" node="harvester-node-1" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="TaintToleration" node="harvester-node-2" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-1" score=45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="NodeResourcesBalancedAllocation" node="harvester-node-2" score=46</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="ImageLocality" node="harvester-node-0" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="ImageLocality" node="harvester-node-1" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" plugin="ImageLocality" node="harvester-node-2" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" node="harvester-node-0" score=1000358</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" node="harvester-node-1" score=1000433</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" node="harvester-node-2" score=1000437</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm1-with-overcommit-6xqmq", node "harvester-node-2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm1-with-overcommit-6xqmq", node "harvester-node-2": all PVCs bound and nothing to do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Attempting to bind pod to node" pod="default/virt-launcher-vm1-with-overcommit-6xqmq" node="harvester-node-2"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></details><details class="details_lb9f alert alert--info details_BAp3" data-collapsed="true"><summary>kube-scheduler logs for vm2-without-overcommit</summary><div><div class="collapsibleContent_i85q"><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-0: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-1: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 45,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-2: NodeResourcesBalancedAllocation, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:6350 memory:7195328512] ,score 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-0: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:9960 memory:15166603264] ,score 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-1: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:5560 memory:6352273408] ,score 34,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virt-launcher-vm2-without-overcommit-mf5vk -&gt; harvester-node-2: NodeResourcesLeastAllocated, map of allocatable resources map[cpu:6000 memory:16776437760], map of requested resources map[cpu:6350 memory:7195328512] ,score 28,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="PodTopologySpread" node="harvester-node-0" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="PodTopologySpread" node="harvester-node-1" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="PodTopologySpread" node="harvester-node-2" score=200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="TaintToleration" node="harvester-node-0" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="TaintToleration" node="harvester-node-1" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="TaintToleration" node="harvester-node-2" score=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesBalancedAllocation" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesBalancedAllocation" node="harvester-node-1" score=45</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesBalancedAllocation" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="ImageLocality" node="harvester-node-0" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="ImageLocality" node="harvester-node-1" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="ImageLocality" node="harvester-node-2" score=54</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="InterPodAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="InterPodAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="InterPodAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesLeastAllocated" node="harvester-node-0" score=4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesLeastAllocated" node="harvester-node-1" score=34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeResourcesLeastAllocated" node="harvester-node-2" score=28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeAffinity" node="harvester-node-0" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeAffinity" node="harvester-node-1" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodeAffinity" node="harvester-node-2" score=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodePreferAvoidPods" node="harvester-node-0" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodePreferAvoidPods" node="harvester-node-1" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Plugin scored node for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" plugin="NodePreferAvoidPods" node="harvester-node-2" score=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" node="harvester-node-0" score=1000358</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" node="harvester-node-1" score=1000433</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Calculated node's final score for pod" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" node="harvester-node-2" score=1000382</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm2-without-overcommit-mf5vk", node "harvester-node-1"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssumePodVolumes for pod "default/virt-launcher-vm2-without-overcommit-mf5vk", node "harvester-node-1": all PVCs bound and nothing to do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"Attempting to bind pod to node" pod="default/virt-launcher-vm2-without-overcommit-mf5vk" node="harvester-node-1"</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></details><p><strong>Table 2 - With Overcommit</strong></p><table><thead><tr><th align="center">VM 1 / VM 2</th><th align="right">harvester-node-0</th><th align="right">harvester-node-1</th><th align="right">harvester-node-2</th></tr></thead><tbody><tr><td align="center">request-cpu (m)</td><td align="right">9022 / 9022</td><td align="right">4622 / 4622</td><td align="right"><strong>4412</strong> / <strong>4474</strong></td></tr><tr><td align="center">request-memory</td><td align="right">14807289856 / 14807289856</td><td align="right">5992960000 / 5992960000</td><td align="right"><strong>5581918208</strong> / <strong>6476701696</strong></td></tr><tr><td align="center">NodeResourcesBalancedAllocation Score</td><td align="right">0 / 0</td><td align="right">58 / 58</td><td align="right"><strong>59</strong> / <strong>64</strong></td></tr><tr><td align="center">NodeResourcesLeastAllocated Score</td><td align="right">5 / 5</td><td align="right">43 / 43</td><td align="right"><strong>46</strong> / <strong>43</strong></td></tr><tr><td align="center">Other Scores</td><td align="right">1000354 / 1000354</td><td align="right">1000354 / 1000354</td><td align="right">1000354 / 1000354</td></tr><tr><td align="center">Total Score</td><td align="right">1000359 / 1000359</td><td align="right">1000455 / 1000455</td><td align="right"><strong>1000459</strong> / <strong>1000461</strong></td></tr></tbody></table><p><strong>Table 3 - Without Overcommit</strong></p><table><thead><tr><th align="center">VM 1 / VM 2</th><th align="right">harvester-node-0</th><th align="right">harvester-node-1</th><th align="right">harvester-node-2</th></tr></thead><tbody><tr><td align="center">request-cpu (m)</td><td align="right">9960 / 9960</td><td align="right">5560 / <strong>5560</strong></td><td align="right"><strong>5350</strong> / 6350</td></tr><tr><td align="center">request-memory</td><td align="right">15166603264 / 15166603264</td><td align="right">6352273408 / <strong>6352273408</strong></td><td align="right"><strong>5941231616</strong> / 7195328512</td></tr><tr><td align="center">NodeResourcesBalancedAllocation Score</td><td align="right">0 / 0</td><td align="right">45 / <strong>45</strong></td><td align="right"><strong>46</strong> / 0</td></tr><tr><td align="center">NodeResourcesLeastAllocated Score</td><td align="right">4 / 4</td><td align="right">34 / <strong>34</strong></td><td align="right"><strong>37</strong> / 28</td></tr><tr><td align="center">Other Scores</td><td align="right">1000354 / 1000354</td><td align="right">1000354 / <strong>1000354</strong></td><td align="right"><strong>1000354</strong> / 1000354</td></tr><tr><td align="center">Total Score</td><td align="right">1000358 / 1000358</td><td align="right">1000358 / <strong>1000433</strong></td><td align="right"><strong>1000437</strong> / 1000382</td></tr></tbody></table><p><strong>Table 4</strong></p><table><thead><tr><th align="center">Score</th><th align="right">harvester-node-0</th><th align="right">harvester-node-1</th><th align="right">harvester-node-2</th></tr></thead><tbody><tr><td align="center">VM 1</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000459</td></tr><tr><td align="center">VM 2</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000461</td></tr><tr><td align="center">VM 3</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000462</td></tr><tr><td align="center">VM 4</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000462</td></tr><tr><td align="center">VM 5</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000463</td></tr><tr><td align="center">VM 6</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000465</td></tr><tr><td align="center">VM 7</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000466</td></tr><tr><td align="center">VM 8</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000467</td></tr><tr><td align="center">VM 9</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000469</td></tr><tr><td align="center">VM 10</td><td align="right">1000359</td><td align="right">1000455</td><td align="right">1000469</td></tr><tr><td align="center">VM 11</td><td align="right">1000359</td><td align="right">1000455</td><td align="right"><strong>1000465</strong></td></tr><tr><td align="center">VM 12</td><td align="right">1000359</td><td align="right">1000455</td><td align="right"><strong>1000457</strong></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-to-avoid-uneven-distribution-of-vms">How to avoid uneven distribution of VMs?<a class="hash-link" href="#how-to-avoid-uneven-distribution-of-vms" title="Direct link to heading">​</a></h2><p>There are many plugins in <code>kube-scheduler</code> which we can use to influence the scores. For example, we can add the <code>podAntiAffinity</code> plugin to avoid VMs with the same labels being deployed on the same node.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - podAffinityTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - key: harvesterhci.io/creator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          topologyKey: kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight: 100</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="how-to-see-scores-in-kube-scheduler">How to see scores in kube-scheduler?<a class="hash-link" href="#how-to-see-scores-in-kube-scheduler" title="Direct link to heading">​</a></h2><p><code>kube-scheduler</code> is deployed as a static pod in Harvester. The file is under <code>/var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml</code> in each Management Node. We can add <code>- --v=10</code> to the <code>kube-scheduler</code> container to show score logs.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    component: kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tier: control-plane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - --v=10</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div>]]></content>
        <author>
            <name>PoAn Yang</name>
            <uri>https://github.com/FrankYang0529</uri>
        </author>
        <category label="vm" term="vm"/>
        <category label="scheduling" term="scheduling"/>
    </entry>
</feed>